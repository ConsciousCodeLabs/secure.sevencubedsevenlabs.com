<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure File Encryption | Patent #65 | Seven Cubed Seven Labs</title>
    <meta name="description" content="Encrypt your files with 2,401 unique pathways. 4-shell recursive encryption. Patent pending technology.">
    
    <!-- JSZip for batch download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #0ea5e9;
            --accent: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #0f172a;
            --dark-lighter: #1e293b;
            --dark-card: #1a2332;
            --gray: #64748b;
            --light: #f1f5f9;
            --white: #ffffff;
            --border: #334155;
            --gradient: linear-gradient(135deg, #6366f1 0%, #0ea5e9 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header h1 .gold { color: #fbbf24; }
        .header h1 .cyan { color: var(--secondary); }

        .header p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        /* Tier Status Bar */
        .tier-bar {
            background: var(--dark-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tier-bar.enterprise {
            border-color: #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
        }

        .tier-bar.starter {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
        }

        .tier-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .tier-icon {
            font-size: 1.5rem;
        }

        .tier-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .tier-name.enterprise { color: #fbbf24; }
        .tier-name.starter { color: var(--accent); }
        .tier-name.free { color: var(--gray); }

        .usage-info {
            text-align: right;
        }

        .usage-count {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .usage-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Main Card */
        .main-card {
            background: var(--gradient);
            border-radius: 16px;
            padding: 3px;
            margin-bottom: 1.5rem;
        }

        .main-card-inner {
            background: var(--dark-card);
            border-radius: 14px;
            padding: 1.5rem;
        }

        .card-header {
            text-align: center;
            padding: 1rem;
            background: var(--gradient);
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .card-header h2 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .card-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* API Key Section */
        .api-key-section {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .api-key-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .api-key-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .api-key-hint {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .api-key-input-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .api-key-input {
            flex: 1;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            color: var(--white);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .api-key-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-small {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-apply {
            background: var(--primary);
            color: white;
        }

        .btn-apply:hover {
            background: var(--primary-dark);
        }

        .btn-clear {
            background: var(--dark-lighter);
            color: var(--gray);
        }

        .btn-clear:hover {
            background: var(--border);
            color: var(--white);
        }

        .key-status {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .key-status.valid { color: var(--accent); }
        .key-status.invalid { color: var(--error); }

        .upgrade-link {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .upgrade-link a {
            color: var(--secondary);
            text-decoration: none;
        }

        .upgrade-link a:hover {
            text-decoration: underline;
        }

        /* Drop Zone */
        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
        }

        .drop-zone:hover, .drop-zone.drag-over {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .drop-zone-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        .drop-zone-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .drop-zone-hint {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .drop-zone-hint .batch-hint {
            color: var(--accent);
            font-weight: 600;
        }

        /* File Queue */
        .file-queue {
            margin-bottom: 1.5rem;
        }

        .file-queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .file-queue-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-count {
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .btn-clear-all {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--gray);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-clear-all:hover {
            border-color: var(--error);
            color: var(--error);
        }

        .file-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            gap: 1rem;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-icon {
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .file-details {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-size {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .file-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-icon {
            font-size: 1.2rem;
        }

        .status-icon.pending { color: var(--gray); }
        .status-icon.encrypting { color: var(--warning); }
        .status-icon.done { color: var(--accent); }
        .status-icon.error { color: var(--error); }

        .file-progress {
            width: 80px;
            height: 6px;
            background: var(--dark);
            border-radius: 3px;
            overflow: hidden;
        }

        .file-progress-bar {
            height: 100%;
            background: var(--gradient);
            border-radius: 3px;
            transition: width 0.3s;
        }

        .file-remove {
            background: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.2rem;
            transition: color 0.2s;
        }

        .file-remove:hover {
            color: var(--error);
        }

        /* Pathway Section */
        .pathway-section {
            margin-bottom: 1.5rem;
        }

        .pathway-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .pathway-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .preset-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .preset-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover, .preset-btn.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.2);
            color: var(--white);
        }

        .shell-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .shell-item {
            text-align: center;
        }

        .shell-label {
            font-size: 0.75rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .shell-select {
            width: 100%;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--white);
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            appearance: none;
        }

        .shell-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .pathway-display {
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            color: var(--secondary);
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .btn {
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-encrypt {
            background: var(--gradient);
            color: white;
        }

        .btn-encrypt:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-encrypt:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-download {
            background: var(--dark-lighter);
            color: var(--white);
            border: 1px solid var(--border);
        }

        .btn-download:hover:not(:disabled) {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.1);
        }

        .btn-download:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Progress Section */
        .batch-progress {
            background: var(--dark-lighter);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        .batch-progress.active {
            display: block;
        }

        .batch-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .batch-progress-text {
            font-weight: 500;
        }

        .batch-progress-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .batch-progress-bar {
            height: 8px;
            background: var(--dark);
            border-radius: 4px;
            overflow: hidden;
        }

        .batch-progress-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 4px;
            transition: width 0.3s;
            width: 0%;
        }

        /* Results Section */
        .results-section {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .results-title {
            font-weight: 600;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-download-all {
            background: var(--accent);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-download-all:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .results-summary {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        .footer-brand {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }

        .footer-links a {
            color: var(--secondary);
            text-decoration: none;
            font-size: 0.85rem;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* Hidden file input */
        #fileInput {
            display: none;
        }

        /* Animations */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }

            .shell-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .tier-bar {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .usage-info {
                text-align: center;
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîê <span class="gold">Seven Cubed Seven</span> <span class="cyan">Labs</span></h1>
            <p>Patent #65 | 2,401 Pathways of Protection</p>
        </div>

        <!-- Tier Status Bar -->
        <div class="tier-bar" id="tierBar">
            <div class="tier-info">
                <span class="tier-icon" id="tierIcon">üÜì</span>
                <span class="tier-name free" id="tierName">Free Tier</span>
            </div>
            <div class="usage-info">
                <div class="usage-count"><span id="usageCount">0</span> / <span id="usageLimit">100</span></div>
                <div class="usage-label" id="usageLabel">encryptions today</div>
            </div>
        </div>

        <!-- Main Card -->
        <div class="main-card">
            <div class="main-card-inner">
                <!-- Card Header -->
                <div class="card-header">
                    <h2>üîê Secure File Encryption</h2>
                    <p>4-Shell Recursive Encryption ‚Ä¢ 2,401 Unique Pathways</p>
                </div>

                <!-- API Key Section -->
                <div class="api-key-section" id="apiKeySection">
                    <div class="api-key-header">
                        <div class="api-key-title">üîë API Key (optional)</div>
                        <div class="api-key-hint">Leave blank for free tier</div>
                    </div>
                    <div class="api-key-input-row">
                        <input type="password" class="api-key-input" id="apiKeyInput" placeholder="Paste your API key here...">
                        <button class="btn-small btn-apply" onclick="applyApiKey()">Apply</button>
                        <button class="btn-small btn-clear" onclick="clearApiKey()">Clear</button>
                    </div>
                    <div class="key-status" id="keyStatus"></div>
                    <div class="upgrade-link">
                        Don't have an API key? <a href="https://sevencubedsevenlabs.com/pricing.html" target="_blank">Get Starter Plan</a> for 50,000 encryptions/month
                    </div>
                </div>

                <!-- Drop Zone -->
                <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <div class="drop-zone-icon">üìÅ</div>
                    <div class="drop-zone-text">Drag & drop files here</div>
                    <div class="drop-zone-hint">or click to browse ‚Ä¢ Max 10MB per file ‚Ä¢ <span class="batch-hint">Multiple files supported!</span></div>
                </div>
                <input type="file" id="fileInput" multiple>

                <!-- File Queue -->
                <div class="file-queue" id="fileQueue" style="display: none;">
                    <div class="file-queue-header">
                        <div class="file-queue-title">
                            üìã Files to Encrypt
                            <span class="file-count" id="fileCount">0</span>
                        </div>
                        <button class="btn-clear-all" onclick="clearAllFiles()">Clear All</button>
                    </div>
                    <div class="file-list" id="fileList"></div>
                </div>

                <!-- Pathway Section -->
                <div class="pathway-section">
                    <div class="pathway-header">
                        <div class="pathway-title">üéØ Select Pathway</div>
                        <div class="preset-buttons">
                            <button class="preset-btn active" onclick="setPreset('standard')">Standard</button>
                            <button class="preset-btn" onclick="setPreset('financial')">Financial</button>
                            <button class="preset-btn" onclick="setPreset('maximum')">Maximum</button>
                        </div>
                    </div>
                    <div class="shell-grid">
                        <div class="shell-item">
                            <div class="shell-label">Shell 1</div>
                            <select class="shell-select" id="shell1" onchange="updatePathwayDisplay()">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="shell-item">
                            <div class="shell-label">Shell 2</div>
                            <select class="shell-select" id="shell2" onchange="updatePathwayDisplay()">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="shell-item">
                            <div class="shell-label">Shell 3</div>
                            <select class="shell-select" id="shell3" onchange="updatePathwayDisplay()">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="shell-item">
                            <div class="shell-label">Shell 4</div>
                            <select class="shell-select" id="shell4" onchange="updatePathwayDisplay()">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                    </div>
                    <div class="pathway-display">Pathway: [<span id="pathwayDisplay">3, 3, 3, 3</span>]</div>
                </div>

                <!-- Batch Progress -->
                <div class="batch-progress" id="batchProgress">
                    <div class="batch-progress-header">
                        <div class="batch-progress-text">üîÑ Encrypting files...</div>
                        <div class="batch-progress-count"><span id="progressCurrent">0</span> / <span id="progressTotal">0</span></div>
                    </div>
                    <div class="batch-progress-bar">
                        <div class="batch-progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="results-section" id="resultsSection">
                    <div class="results-header">
                        <div class="results-title">‚úÖ Encryption Complete!</div>
                        <button class="btn-download-all" onclick="downloadAllAsZip()">
                            üì¶ Download All (ZIP)
                        </button>
                    </div>
                    <div class="results-summary" id="resultsSummary">
                        0 files encrypted successfully
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-encrypt" id="encryptBtn" onclick="encryptAllFiles()" disabled>
                        üîí Encrypt Files
                    </button>
                    <button class="btn btn-download" id="downloadBtn" onclick="downloadAllAsZip()" disabled>
                        üì¶ Download ZIP
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-brand">üîê Patent #65 | Seven Cubed Seven Labs LLC | 7¬≥ √ó 7 = 2,401</div>
            <div class="footer-links">
                <a href="https://sevencubedsevenlabs.com">Home</a>
                <a href="https://sevencubedsevenlabs.com/pricing.html">Pricing</a>
                <a href="https://sevencubedsevenlabs.com/guide.html">Best Practices</a>
                <a href="https://api.sevencubedsevenlabs.com/docs" target="_blank">API Docs</a>
                <a href="https://sevencubedsevenlabs.com/terms.html">Terms</a>
                <a href="https://sevencubedsevenlabs.com/privacy.html">Privacy</a>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'https://api.sevencubedsevenlabs.com';
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
        const STORAGE_KEY = 'patent65_api_key';

        // State
        let currentApiKey = localStorage.getItem(STORAGE_KEY) || '';
        let currentTier = 'free';
        let usageCount = 0;
        let filesToEncrypt = [];
        let encryptedResults = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupDropZone();
            setupFileInput();
            if (currentApiKey) {
                document.getElementById('apiKeyInput').value = currentApiKey;
                validateApiKey(currentApiKey);
            }
            updatePathwayDisplay();
        });

        // Drop Zone Setup
        function setupDropZone() {
            const dropZone = document.getElementById('dropZone');

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                handleFiles(e.dataTransfer.files);
            });
        }

        // File Input Setup
        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
                e.target.value = ''; // Reset for same file selection
            });
        }

        // Handle Files
        function handleFiles(files) {
            for (const file of files) {
                if (file.size > MAX_FILE_SIZE) {
                    alert(`File "${file.name}" exceeds 10MB limit`);
                    continue;
                }

                // Check if file already in queue
                if (filesToEncrypt.some(f => f.name === file.name && f.size === file.size)) {
                    continue;
                }

                filesToEncrypt.push({
                    file: file,
                    name: file.name,
                    size: file.size,
                    status: 'pending',
                    progress: 0,
                    result: null
                });
            }

            updateFileQueue();
            updateEncryptButton();
        }

        // Update File Queue UI
        function updateFileQueue() {
            const queueEl = document.getElementById('fileQueue');
            const listEl = document.getElementById('fileList');
            const countEl = document.getElementById('fileCount');

            if (filesToEncrypt.length === 0) {
                queueEl.style.display = 'none';
                return;
            }

            queueEl.style.display = 'block';
            countEl.textContent = filesToEncrypt.length;

            listEl.innerHTML = filesToEncrypt.map((item, index) => `
                <div class="file-item" id="file-${index}">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name">${escapeHtml(item.name)}</div>
                        <div class="file-size">${formatFileSize(item.size)}</div>
                    </div>
                    <div class="file-status">
                        <span class="status-icon ${item.status}">${getStatusIcon(item.status)}</span>
                        <div class="file-progress">
                            <div class="file-progress-bar" style="width: ${item.progress}%"></div>
                        </div>
                    </div>
                    <button class="file-remove" onclick="removeFile(${index})" ${item.status === 'encrypting' ? 'disabled' : ''}>√ó</button>
                </div>
            `).join('');
        }

        // Get Status Icon
        function getStatusIcon(status) {
            switch (status) {
                case 'pending': return '‚è≥';
                case 'encrypting': return 'üîÑ';
                case 'done': return '‚úÖ';
                case 'error': return '‚ùå';
                default: return '‚è≥';
            }
        }

        // Remove File
        function removeFile(index) {
            filesToEncrypt.splice(index, 1);
            updateFileQueue();
            updateEncryptButton();
        }

        // Clear All Files
        function clearAllFiles() {
            filesToEncrypt = [];
            encryptedResults = [];
            updateFileQueue();
            updateEncryptButton();
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('batchProgress').classList.remove('active');
        }

        // Update Encrypt Button State
        function updateEncryptButton() {
            const btn = document.getElementById('encryptBtn');
            const pendingFiles = filesToEncrypt.filter(f => f.status === 'pending').length;
            btn.disabled = pendingFiles === 0;
            btn.textContent = pendingFiles > 0 ? `üîí Encrypt ${pendingFiles} File${pendingFiles > 1 ? 's' : ''}` : 'üîí Encrypt Files';
        }

        // Encrypt All Files
        async function encryptAllFiles() {
            const pendingFiles = filesToEncrypt.filter(f => f.status === 'pending');
            if (pendingFiles.length === 0) return;

            const pathway = getPathway();
            encryptedResults = [];

            // Show progress
            document.getElementById('batchProgress').classList.add('active');
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('encryptBtn').disabled = true;
            document.getElementById('progressTotal').textContent = pendingFiles.length;

            for (let i = 0; i < filesToEncrypt.length; i++) {
                const item = filesToEncrypt[i];
                if (item.status !== 'pending') continue;

                // Update progress
                document.getElementById('progressCurrent').textContent = encryptedResults.length + 1;
                document.getElementById('progressFill').style.width = `${((encryptedResults.length) / pendingFiles.length) * 100}%`;

                // Update file status
                item.status = 'encrypting';
                item.progress = 50;
                updateFileQueue();

                try {
                    const result = await encryptFile(item.file, pathway);
                    item.status = 'done';
                    item.progress = 100;
                    item.result = result;
                    encryptedResults.push({
                        name: item.name,
                        ...result
                    });
                } catch (error) {
                    item.status = 'error';
                    item.progress = 0;
                    console.error(`Error encrypting ${item.name}:`, error);
                }

                updateFileQueue();
            }

            // Complete
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('progressCurrent').textContent = pendingFiles.length;

            // Show results
            setTimeout(() => {
                document.getElementById('batchProgress').classList.remove('active');
                if (encryptedResults.length > 0) {
                    document.getElementById('resultsSection').classList.add('active');
                    document.getElementById('resultsSummary').textContent = 
                        `${encryptedResults.length} file${encryptedResults.length > 1 ? 's' : ''} encrypted successfully with pathway [${pathway.join(', ')}]`;
                    document.getElementById('downloadBtn').disabled = false;
                }
            }, 500);

            updateEncryptButton();
        }

        // Encrypt Single File
        async function encryptFile(file, pathway) {
            // Read file as base64
            const base64 = await fileToBase64(file);

            const response = await fetch(`${API_BASE}/encrypt`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    ...(currentApiKey && { 'X-API-Key': currentApiKey })
                },
                body: JSON.stringify({
                    plaintext: base64,
                    pathway: pathway
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'Encryption failed');
            }

            const result = await response.json();

            // Update usage
            if (result.usage) {
                usageCount = result.usage.current;
                document.getElementById('usageCount').textContent = usageCount;
            }

            return {
                ciphertext: result.ciphertext,
                key: result.key,
                pathway: result.pathway_used
            };
        }

        // File to Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1] || reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Download All as ZIP
        async function downloadAllAsZip() {
            if (encryptedResults.length === 0) return;

            const zip = new JSZip();
            const pathway = getPathway();
            const timestamp = new Date().toISOString().slice(0, 10);

            // Create folders
            const encryptedFolder = zip.folder('encrypted_files');
            const keysFolder = zip.folder('keys');

            // Add files
            for (const result of encryptedResults) {
                const baseName = result.name.replace(/\.[^/.]+$/, '');
                
                // Add encrypted file
                encryptedFolder.file(`${result.name}.encrypted`, result.ciphertext);
                
                // Add key file
                keysFolder.file(`${result.name}.key`, result.key);
            }

            // Add manifest
            const manifest = {
                generated: new Date().toISOString(),
                pathway: pathway,
                files: encryptedResults.map(r => ({
                    original: r.name,
                    encrypted: `${r.name}.encrypted`,
                    key: `${r.name}.key`
                })),
                note: "IMPORTANT: You need BOTH the .encrypted file AND the .key file (plus the pathway) to decrypt!",
                api: "https://api.sevencubedsevenlabs.com",
                company: "Seven Cubed Seven Labs LLC",
                patent: "Patent #65 - 2,401 Pathways"
            };
            zip.file('manifest.json', JSON.stringify(manifest, null, 2));

            // Add README
            const readme = `# Patent #65 Encrypted Files
Generated: ${new Date().toISOString()}
Pathway: [${pathway.join(', ')}]

## Contents
- /encrypted_files/ - Your encrypted files
- /keys/ - Decryption keys (KEEP SECURE!)
- manifest.json - File mapping and metadata

## IMPORTANT: The Golden Rule
To decrypt ANY file, you need ALL THREE:
1. The .encrypted file
2. The .key file  
3. The pathway: [${pathway.join(', ')}]

Store encrypted files and keys in DIFFERENT locations!

## To Decrypt
Visit: https://secure.sevencubedsevenlabs.com

## Support
Email: 7cubed7@proton.me
Docs: https://api.sevencubedsevenlabs.com/docs

---
Seven Cubed Seven Labs LLC
Patent #65: Recursive 7‚Å¥-Lattice Cryptographic Shell System
7¬≥ √ó 7 = 2,401 Pathways of Protection
`;
            zip.file('README.txt', readme);

            // Generate and download
            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = `patent65_encrypted_${timestamp}.zip`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // API Key Functions
        async function applyApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (!key) {
                clearApiKey();
                return;
            }
            await validateApiKey(key);
        }

        async function validateApiKey(key) {
            try {
                const response = await fetch(`${API_BASE}/validate-key`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ api_key: key })
                });

                const result = await response.json();

                if (result.valid) {
                    currentApiKey = key;
                    localStorage.setItem(STORAGE_KEY, key);
                    currentTier = result.tier;
                    updateTierDisplay(result.tier, result.usage);
                    document.getElementById('keyStatus').textContent = `‚úÖ API key applied - ${result.tier.charAt(0).toUpperCase() + result.tier.slice(1)} Plan active`;
                    document.getElementById('keyStatus').className = 'key-status valid';
                } else {
                    document.getElementById('keyStatus').textContent = '‚ùå ' + result.message;
                    document.getElementById('keyStatus').className = 'key-status invalid';
                }
            } catch (error) {
                document.getElementById('keyStatus').textContent = '‚ùå Could not validate key';
                document.getElementById('keyStatus').className = 'key-status invalid';
            }
        }

        function clearApiKey() {
            currentApiKey = '';
            localStorage.removeItem(STORAGE_KEY);
            document.getElementById('apiKeyInput').value = '';
            document.getElementById('keyStatus').textContent = '';
            updateTierDisplay('free', null);
        }

        function updateTierDisplay(tier, usage) {
            const tierBar = document.getElementById('tierBar');
            const tierIcon = document.getElementById('tierIcon');
            const tierName = document.getElementById('tierName');
            const usageCountEl = document.getElementById('usageCount');
            const usageLimitEl = document.getElementById('usageLimit');
            const usageLabel = document.getElementById('usageLabel');

            tierBar.className = 'tier-bar ' + tier;
            tierName.className = 'tier-name ' + tier;

            if (tier === 'enterprise') {
                tierIcon.textContent = 'üè¢';
                tierName.textContent = 'Enterprise';
                usageCountEl.textContent = usage?.current || 0;
                usageLimitEl.textContent = '‚àû';
                usageLabel.textContent = 'unlimited';
            } else if (tier === 'starter') {
                tierIcon.textContent = '‚≠ê';
                tierName.textContent = 'Starter Plan';
                usageCountEl.textContent = usage?.current || 0;
                usageLimitEl.textContent = '50,000';
                usageLabel.textContent = 'encryptions this month';
            } else {
                tierIcon.textContent = 'üÜì';
                tierName.textContent = 'Free Tier';
                usageCountEl.textContent = usage?.current || 0;
                usageLimitEl.textContent = '100';
                usageLabel.textContent = 'encryptions today';
            }

            usageCount = usage?.current || 0;
        }

        // Pathway Functions
        function getPathway() {
            return [
                parseInt(document.getElementById('shell1').value),
                parseInt(document.getElementById('shell2').value),
                parseInt(document.getElementById('shell3').value),
                parseInt(document.getElementById('shell4').value)
            ];
        }

        function setPreset(preset) {
            const presets = {
                standard: [3, 3, 3, 3],
                financial: [5, 2, 1, 4],
                maximum: [7, 7, 7, 7]
            };

            const pathway = presets[preset];
            document.getElementById('shell1').value = pathway[0];
            document.getElementById('shell2').value = pathway[1];
            document.getElementById('shell3').value = pathway[2];
            document.getElementById('shell4').value = pathway[3];

            // Update active button
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            updatePathwayDisplay();
        }

        function updatePathwayDisplay() {
            const pathway = getPathway();
            document.getElementById('pathwayDisplay').textContent = pathway.join(', ');
        }

        // Utilities
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
