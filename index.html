<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure File Encryption | Patent #65 | Seven Cubed Seven Labs</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --primary: #4F46E5;
            --primary-dark: #3730a3;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--gray-900) 0%, var(--gray-800) 100%);
            min-height: 100vh;
            color: var(--gray-100);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .logo span {
            color: var(--primary);
        }
        
        .tagline {
            color: var(--gray-400);
            font-size: 0.9rem;
        }
        
        /* Status Bar */
        .status-bar {
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .status-bar.free {
            border-color: var(--gray-600);
        }
        
        .status-bar.starter {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(14, 165, 233, 0.1) 100%);
        }
        
        .status-bar.enterprise {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(234, 179, 8, 0.1) 100%);
        }
        
        .tier-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        
        .tier-badge.free {
            color: var(--gray-400);
        }
        
        .tier-badge.starter {
            color: var(--primary);
        }
        
        .tier-badge.enterprise {
            color: var(--warning);
        }
        
        .tier-icon {
            font-size: 1.25rem;
        }
        
        .usage-info {
            text-align: right;
            font-size: 0.85rem;
            color: var(--gray-400);
        }
        
        .usage-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: white;
            font-weight: 600;
        }
        
        .upgrade-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .upgrade-link:hover {
            text-decoration: underline;
        }
        
        /* Main Card */
        .main-card {
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            border-radius: 16px;
            overflow: hidden;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0ea5e9 100%);
            padding: 1.5rem;
            text-align: center;
        }
        
        .card-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .card-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .card-body {
            padding: 2rem;
        }
        
        /* API Key Section */
        .api-key-section {
            background: var(--gray-900);
            border: 1px solid var(--gray-700);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }
        
        .api-key-section.has-key {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .api-key-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .api-key-label {
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .api-key-label .icon {
            font-size: 1.1rem;
        }
        
        .api-key-hint {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .api-key-input-wrapper {
            position: relative;
        }
        
        .api-key-input {
            width: 100%;
            padding: 0.75rem 1rem;
            padding-right: 100px;
            background: var(--gray-800);
            border: 1px solid var(--gray-600);
            border-radius: 8px;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        
        .api-key-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .api-key-input::placeholder {
            color: var(--gray-500);
        }
        
        .api-key-actions {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-small {
            padding: 0.4rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-apply {
            background: var(--primary);
            color: white;
        }
        
        .btn-apply:hover {
            background: var(--primary-dark);
        }
        
        .btn-clear {
            background: var(--gray-700);
            color: var(--gray-300);
        }
        
        .btn-clear:hover {
            background: var(--gray-600);
        }
        
        .api-key-status {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .api-key-status.valid {
            color: var(--success);
        }
        
        .api-key-status.invalid {
            color: var(--danger);
        }
        
        .api-key-footer {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: var(--gray-500);
        }
        
        .api-key-footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .api-key-footer a:hover {
            text-decoration: underline;
        }
        
        /* Drop Zone */
        .drop-zone {
            border: 2px dashed var(--gray-600);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }
        
        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }
        
        .drop-zone-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .drop-zone-text {
            color: var(--gray-300);
            margin-bottom: 0.5rem;
        }
        
        .drop-zone-hint {
            color: var(--gray-500);
            font-size: 0.85rem;
        }
        
        .file-input {
            display: none;
        }
        
        /* File Info */
        .file-info {
            background: var(--gray-900);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .file-info.visible {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .file-icon {
            font-size: 2rem;
        }
        
        .file-details {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: white;
            word-break: break-all;
        }
        
        .file-size {
            font-size: 0.85rem;
            color: var(--gray-400);
        }
        
        .file-remove {
            background: var(--gray-700);
            border: none;
            color: var(--gray-400);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.25rem;
        }
        
        .file-remove:hover {
            background: var(--danger);
            color: white;
        }
        
        /* Pathway Selector */
        .pathway-section {
            margin-bottom: 1.5rem;
        }
        
        .pathway-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .pathway-label {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .pathway-presets {
            display: flex;
            gap: 0.5rem;
        }
        
        .preset-btn {
            padding: 0.35rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--gray-600);
            background: transparent;
            color: var(--gray-400);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preset-btn:hover, .preset-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }
        
        .pathway-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .shell-selector {
            background: var(--gray-900);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }
        
        .shell-label {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .shell-select {
            width: 100%;
            padding: 0.6rem;
            background: var(--gray-800);
            border: 1px solid var(--gray-600);
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
        }
        
        .shell-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .pathway-display {
            text-align: center;
            margin-top: 1rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .btn {
            padding: 1rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #0ea5e9 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: var(--gray-700);
            color: var(--gray-300);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-600);
        }
        
        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Results Section */
        .results-section {
            margin-top: 2rem;
            display: none;
        }
        
        .results-section.visible {
            display: block;
        }
        
        .result-card {
            background: var(--gray-900);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .result-icon {
            font-size: 1.5rem;
        }
        
        .result-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-700);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: var(--gray-400);
        }
        
        .result-value {
            font-family: 'JetBrains Mono', monospace;
            color: var(--success);
        }
        
        .download-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .btn-download {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .btn-download.encrypted {
            background: var(--primary);
            color: white;
        }
        
        .btn-download.key {
            background: var(--success);
            color: white;
        }
        
        .btn-download:hover {
            transform: translateY(-2px);
        }
        
        /* Warning Banner */
        .warning-banner {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }
        
        .warning-banner .icon {
            font-size: 1.25rem;
            color: var(--warning);
        }
        
        .warning-banner .text {
            font-size: 0.85rem;
            color: var(--gray-300);
        }
        
        .warning-banner strong {
            color: var(--warning);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-overlay.visible {
            display: flex;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--gray-700);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--gray-300);
        }
        
        /* Rate Limit Warning */
        .rate-limit-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .rate-limit-warning.visible {
            display: block;
        }
        
        .rate-limit-warning h3 {
            color: var(--danger);
            margin-bottom: 0.5rem;
        }
        
        .rate-limit-warning p {
            color: var(--gray-400);
            margin-bottom: 1rem;
        }
        
        .rate-limit-warning .btn {
            display: inline-flex;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray-500);
            font-size: 0.85rem;
        }
        
        .footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .footer-links {
            margin-top: 0.5rem;
        }
        
        .footer-links a {
            margin: 0 0.75rem;
        }
        
        /* Responsive */
        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }
            
            .status-bar {
                flex-direction: column;
                text-align: center;
            }
            
            .usage-info {
                text-align: center;
            }
            
            .pathway-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons, .download-buttons {
                grid-template-columns: 1fr;
            }
            
            .api-key-input {
                padding-right: 1rem;
            }
            
            .api-key-actions {
                position: static;
                transform: none;
                margin-top: 0.75rem;
                justify-content: flex-end;
            }
            
            .api-key-input-wrapper {
                display: flex;
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üîê <span>Seven Cubed Seven</span> Labs</div>
            <div class="tagline">Patent #65 | 2,401 Pathways of Protection</div>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar free" id="statusBar">
            <div class="tier-badge free" id="tierBadge">
                <span class="tier-icon">üÜì</span>
                <span id="tierName">Free Tier</span>
            </div>
            <div class="usage-info">
                <div class="usage-count" id="usageCount">0 / 100</div>
                <div id="usagePeriod">encryptions today</div>
                <a href="pricing.html" class="upgrade-link" id="upgradeLink">Upgrade to Starter ‚Üí</a>
            </div>
        </div>
        
        <!-- Rate Limit Warning -->
        <div class="rate-limit-warning" id="rateLimitWarning">
            <h3>‚ö†Ô∏è Daily Limit Reached</h3>
            <p>You've used all 100 free encryptions for today. Upgrade to Starter for 50,000 encryptions per month!</p>
            <a href="pricing.html" class="btn btn-primary">Upgrade Now - $29.99/mo</a>
        </div>
        
        <!-- Main Card -->
        <div class="main-card">
            <div class="card-header">
                <h1>üîê Secure File Encryption</h1>
                <p>4-Shell Recursive Encryption ‚Ä¢ 2,401 Unique Pathways</p>
            </div>
            
            <div class="card-body">
                <!-- API Key Section -->
                <div class="api-key-section" id="apiKeySection">
                    <div class="api-key-header">
                        <div class="api-key-label">
                            <span class="icon">üîë</span>
                            API Key (optional)
                        </div>
                        <div class="api-key-hint">Leave blank for free tier</div>
                    </div>
                    <div class="api-key-input-wrapper">
                        <input 
                            type="password" 
                            class="api-key-input" 
                            id="apiKeyInput" 
                            placeholder="Paste your API key here..."
                        >
                        <div class="api-key-actions">
                            <button class="btn-small btn-apply" id="applyKeyBtn">Apply</button>
                            <button class="btn-small btn-clear" id="clearKeyBtn">Clear</button>
                        </div>
                    </div>
                    <div class="api-key-status" id="apiKeyStatus"></div>
                    <div class="api-key-footer">
                        Don't have an API key? <a href="pricing.html">Get Starter Plan</a> for 50,000 encryptions/month
                    </div>
                </div>
                
                <!-- Drop Zone -->
                <div class="drop-zone" id="dropZone">
                    <div class="drop-zone-icon">üìÅ</div>
                    <div class="drop-zone-text">Drag & drop a file here</div>
                    <div class="drop-zone-hint">or click to browse ‚Ä¢ Max 10MB</div>
                    <input type="file" class="file-input" id="fileInput">
                </div>
                
                <!-- File Info -->
                <div class="file-info" id="fileInfo">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name" id="fileName">document.pdf</div>
                        <div class="file-size" id="fileSize">1.2 MB</div>
                    </div>
                    <button class="file-remove" id="removeFile">√ó</button>
                </div>
                
                <!-- Pathway Selector -->
                <div class="pathway-section">
                    <div class="pathway-header">
                        <div class="pathway-label">
                            <span>üõ§Ô∏è</span>
                            Select Pathway
                        </div>
                        <div class="pathway-presets">
                            <button class="preset-btn" data-pathway="3,3,3,3">Standard</button>
                            <button class="preset-btn" data-pathway="5,2,1,4">Financial</button>
                            <button class="preset-btn" data-pathway="7,7,7,7">Maximum</button>
                        </div>
                    </div>
                    <div class="pathway-grid">
                        <div class="shell-selector">
                            <div class="shell-label">Shell 1</div>
                            <select class="shell-select" id="shell1">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="shell-selector">
                            <div class="shell-label">Shell 2</div>
                            <select class="shell-select" id="shell2">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="shell-selector">
                            <div class="shell-label">Shell 3</div>
                            <select class="shell-select" id="shell3">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="shell-selector">
                            <div class="shell-label">Shell 4</div>
                            <select class="shell-select" id="shell4">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                    </div>
                    <div class="pathway-display">
                        Pathway: [<span id="pathwayDisplay">3, 3, 3, 3</span>]
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="encryptBtn" disabled>
                        <span>üîí</span> Encrypt File
                    </button>
                    <button class="btn btn-secondary" id="decryptBtn" disabled>
                        <span>üîì</span> Decrypt File
                    </button>
                </div>
                
                <!-- Results Section -->
                <div class="results-section" id="resultsSection">
                    <div class="result-card">
                        <div class="result-header">
                            <span class="result-icon">‚úÖ</span>
                            <span class="result-title">Encryption Successful</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Original Size</span>
                            <span class="result-value" id="resultOriginalSize">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Encrypted Size</span>
                            <span class="result-value" id="resultEncryptedSize">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Pathway Used</span>
                            <span class="result-value" id="resultPathway">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Encryption Time</span>
                            <span class="result-value" id="resultTime">-</span>
                        </div>
                        
                        <div class="download-buttons">
                            <button class="btn-download encrypted" id="downloadEncrypted">
                                üìÑ Download .encrypted
                            </button>
                            <button class="btn-download key" id="downloadKey">
                                üîë Download .key
                            </button>
                        </div>
                        
                        <div class="warning-banner">
                            <span class="icon">‚ö†Ô∏è</span>
                            <div class="text">
                                <strong>IMPORTANT:</strong> Download BOTH files! You need the .encrypted file AND the .key file to decrypt your data. Store them in different locations for maximum security.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>üîê Patent #65 | Seven Cubed Seven Labs LLC | 7¬≥ √ó 7 = 2,401</p>
            <div class="footer-links">
                <a href="https://sevencubedsevenlabs.com">Home</a>
                <a href="https://sevencubedsevenlabs.com/pricing.html">Pricing</a>
                <a href="https://sevencubedsevenlabs.com/guide.html">Best Practices</a>
                <a href="https://api.sevencubedsevenlabs.com/docs" target="_blank">API Docs</a>
                <a href="https://sevencubedsevenlabs.com/terms.html">Terms</a>
                <a href="https://sevencubedsevenlabs.com/privacy.html">Privacy</a>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Encrypting through 4 shells...</div>
        </div>
    </div>
    
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const API_BASE = 'https://api.sevencubedsevenlabs.com';
        const STORAGE_KEY_API = 'patent65_api_key';
        const STORAGE_KEY_USAGE = 'patent65_usage';
        
        // ============================================
        // STATE
        // ============================================
        let currentFile = null;
        let currentApiKey = null;
        let encryptedData = null;
        let keyData = null;
        let userTier = 'free';
        let usageCount = 0;
        let usageLimit = 100;
        
        // ============================================
        // DOM ELEMENTS
        // ============================================
        const elements = {
            statusBar: document.getElementById('statusBar'),
            tierBadge: document.getElementById('tierBadge'),
            tierName: document.getElementById('tierName'),
            usageCount: document.getElementById('usageCount'),
            usagePeriod: document.getElementById('usagePeriod'),
            upgradeLink: document.getElementById('upgradeLink'),
            rateLimitWarning: document.getElementById('rateLimitWarning'),
            apiKeySection: document.getElementById('apiKeySection'),
            apiKeyInput: document.getElementById('apiKeyInput'),
            apiKeyStatus: document.getElementById('apiKeyStatus'),
            applyKeyBtn: document.getElementById('applyKeyBtn'),
            clearKeyBtn: document.getElementById('clearKeyBtn'),
            dropZone: document.getElementById('dropZone'),
            fileInput: document.getElementById('fileInput'),
            fileInfo: document.getElementById('fileInfo'),
            fileName: document.getElementById('fileName'),
            fileSize: document.getElementById('fileSize'),
            removeFile: document.getElementById('removeFile'),
            shell1: document.getElementById('shell1'),
            shell2: document.getElementById('shell2'),
            shell3: document.getElementById('shell3'),
            shell4: document.getElementById('shell4'),
            pathwayDisplay: document.getElementById('pathwayDisplay'),
            encryptBtn: document.getElementById('encryptBtn'),
            decryptBtn: document.getElementById('decryptBtn'),
            resultsSection: document.getElementById('resultsSection'),
            resultOriginalSize: document.getElementById('resultOriginalSize'),
            resultEncryptedSize: document.getElementById('resultEncryptedSize'),
            resultPathway: document.getElementById('resultPathway'),
            resultTime: document.getElementById('resultTime'),
            downloadEncrypted: document.getElementById('downloadEncrypted'),
            downloadKey: document.getElementById('downloadKey'),
            loadingOverlay: document.getElementById('loadingOverlay')
        };
        
        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            // Load saved API key
            const savedKey = localStorage.getItem(STORAGE_KEY_API);
            if (savedKey) {
                elements.apiKeyInput.value = savedKey;
                validateAndApplyKey(savedKey);
            } else {
                loadFreeUsage();
            }
            
            // Event Listeners
            setupEventListeners();
            updatePathwayDisplay();
        }
        
        function setupEventListeners() {
            // API Key
            elements.applyKeyBtn.addEventListener('click', () => {
                const key = elements.apiKeyInput.value.trim();
                validateAndApplyKey(key);
            });
            
            elements.clearKeyBtn.addEventListener('click', clearApiKey);
            
            elements.apiKeyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const key = elements.apiKeyInput.value.trim();
                    validateAndApplyKey(key);
                }
            });
            
            // Drop Zone
            elements.dropZone.addEventListener('click', () => elements.fileInput.click());
            elements.dropZone.addEventListener('dragover', handleDragOver);
            elements.dropZone.addEventListener('dragleave', handleDragLeave);
            elements.dropZone.addEventListener('drop', handleDrop);
            elements.fileInput.addEventListener('change', handleFileSelect);
            elements.removeFile.addEventListener('click', removeFile);
            
            // Pathway
            document.querySelectorAll('.shell-select').forEach(select => {
                select.addEventListener('change', updatePathwayDisplay);
            });
            
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => applyPreset(btn.dataset.pathway));
            });
            
            // Actions
            elements.encryptBtn.addEventListener('click', encryptFile);
            elements.decryptBtn.addEventListener('click', decryptFile);
            elements.downloadEncrypted.addEventListener('click', downloadEncryptedFile);
            elements.downloadKey.addEventListener('click', downloadKeyFile);
        }
        
        // ============================================
        // API KEY MANAGEMENT
        // ============================================
        async function validateAndApplyKey(key) {
    if (!key) {
        clearApiKey();
        return;
    }
    
    // Basic format validation (64 hex chars)
    if (!/^[a-f0-9]{64}$/i.test(key)) {
        showKeyStatus('invalid', '‚ùå Invalid key format (expected 64 hex characters)');
        return;
    }
    
    // Validate against server to get actual tier
    try {
        const response = await fetch(`${API_BASE}/validate-key`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ api_key: key })
        });
        
        const result = await response.json();
        
        if (result.valid) {
            currentApiKey = key;
            localStorage.setItem(STORAGE_KEY_API, key);
            
            // Set the ACTUAL tier from server
            setTier(result.tier);
            showKeyStatus('valid', `‚úÖ API key applied - ${result.tier.charAt(0).toUpperCase() + result.tier.slice(1)} Plan active`);
            elements.apiKeySection.classList.add('has-key');
            
            // Update usage from server response
            if (result.usage) {
                usageCount = result.usage.current;
                updateUsageDisplay();
            }
        } else {
            showKeyStatus('invalid', '‚ùå ' + result.message);
        }
    } catch (error) {
        // If server validation fails, fall back to format-only check
        console.warn('Server validation failed, using format check only:', error);
        currentApiKey = key;
        localStorage.setItem(STORAGE_KEY_API, key);
        setTier('starter');
        showKeyStatus('valid', '‚úÖ API key applied - Starter Plan active');
        elements.apiKeySection.classList.add('has-key');
    }
}
        
        function clearApiKey() {
            currentApiKey = null;
            localStorage.removeItem(STORAGE_KEY_API);
            elements.apiKeyInput.value = '';
            elements.apiKeySection.classList.remove('has-key');
            elements.apiKeyStatus.innerHTML = '';
            setTier('free');
            loadFreeUsage();
        }
        
        function showKeyStatus(type, message) {
            elements.apiKeyStatus.className = 'api-key-status ' + type;
            elements.apiKeyStatus.innerHTML = message;
        }
        
        // ============================================
        // TIER & USAGE MANAGEMENT
        // ============================================
        function setTier(tier) {
            userTier = tier;
            
            // Update status bar
            elements.statusBar.className = 'status-bar ' + tier;
            elements.tierBadge.className = 'tier-badge ' + tier;
            
            if (tier === 'free') {
                elements.tierBadge.querySelector('.tier-icon').textContent = 'üÜì';
                elements.tierName.textContent = 'Free Tier';
                elements.usagePeriod.textContent = 'encryptions today';
                elements.upgradeLink.style.display = 'inline';
                usageLimit = 100;
            } else if (tier === 'starter') {
                elements.tierBadge.querySelector('.tier-icon').textContent = '‚≠ê';
                elements.tierName.textContent = 'Starter Plan';
                elements.usagePeriod.textContent = 'encryptions this month';
                elements.upgradeLink.style.display = 'none';
                usageLimit = 50000;
                usageCount = 0; // Reset for demo, in production fetch from server
            } else if (tier === 'enterprise') {
                elements.tierBadge.querySelector('.tier-icon').textContent = 'üè¢';
                elements.tierName.textContent = 'Enterprise';
                elements.usagePeriod.textContent = 'unlimited';
                elements.upgradeLink.style.display = 'none';
                usageLimit = Infinity;
            }
            
            updateUsageDisplay();
        }
        
        function loadFreeUsage() {
            // Load today's usage from localStorage
            const today = new Date().toDateString();
            const saved = JSON.parse(localStorage.getItem(STORAGE_KEY_USAGE) || '{}');
            
            if (saved.date === today) {
                usageCount = saved.count || 0;
            } else {
                // New day, reset count
                usageCount = 0;
                saveFreeUsage();
            }
            
            updateUsageDisplay();
            checkRateLimit();
        }
        
        function saveFreeUsage() {
            const today = new Date().toDateString();
            localStorage.setItem(STORAGE_KEY_USAGE, JSON.stringify({
                date: today,
                count: usageCount
            }));
        }
        
        function incrementUsage() {
            usageCount++;
            if (userTier === 'free') {
                saveFreeUsage();
            }
            updateUsageDisplay();
            checkRateLimit();
        }
        
        function updateUsageDisplay() {
            if (userTier === 'enterprise') {
                elements.usageCount.textContent = usageCount + ' / ‚àû';
            } else {
                elements.usageCount.textContent = usageCount + ' / ' + usageLimit.toLocaleString();
            }
        }
        
        function checkRateLimit() {
            if (userTier === 'free' && usageCount >= usageLimit) {
                elements.rateLimitWarning.classList.add('visible');
                elements.encryptBtn.disabled = true;
            } else {
                elements.rateLimitWarning.classList.remove('visible');
                updateButtonState();
            }
        }
        
        // ============================================
        // FILE HANDLING
        // ============================================
        function handleDragOver(e) {
            e.preventDefault();
            elements.dropZone.classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            elements.dropZone.classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            elements.dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }
        
        function processFile(file) {
            // Check file size (10MB max)
            if (file.size > 10 * 1024 * 1024) {
                alert('File too large. Maximum size is 10MB.');
                return;
            }
            
            currentFile = file;
            elements.fileName.textContent = file.name;
            elements.fileSize.textContent = formatFileSize(file.size);
            elements.fileInfo.classList.add('visible');
            elements.dropZone.style.display = 'none';
            
            // Check if it's an encrypted file (for decryption)
            if (file.name.endsWith('.encrypted')) {
                elements.decryptBtn.disabled = false;
                elements.encryptBtn.disabled = true;
            } else {
                elements.encryptBtn.disabled = false;
                elements.decryptBtn.disabled = true;
            }
            
            // Hide previous results
            elements.resultsSection.classList.remove('visible');
        }
        
        function removeFile() {
            currentFile = null;
            elements.fileInfo.classList.remove('visible');
            elements.dropZone.style.display = 'block';
            elements.fileInput.value = '';
            elements.encryptBtn.disabled = true;
            elements.decryptBtn.disabled = true;
            elements.resultsSection.classList.remove('visible');
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
        
        function updateButtonState() {
            if (!currentFile) {
                elements.encryptBtn.disabled = true;
                elements.decryptBtn.disabled = true;
                return;
            }
            
            if (currentFile.name.endsWith('.encrypted')) {
                elements.decryptBtn.disabled = false;
                elements.encryptBtn.disabled = true;
            } else {
                elements.encryptBtn.disabled = userTier === 'free' && usageCount >= usageLimit;
                elements.decryptBtn.disabled = true;
            }
        }
        
        // ============================================
        // PATHWAY MANAGEMENT
        // ============================================
        function updatePathwayDisplay() {
            const pathway = getPathway();
            elements.pathwayDisplay.textContent = pathway.join(', ');
            
            // Update preset buttons
            const pathwayStr = pathway.join(',');
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.pathway === pathwayStr);
            });
        }
        
        function getPathway() {
            return [
                parseInt(elements.shell1.value),
                parseInt(elements.shell2.value),
                parseInt(elements.shell3.value),
                parseInt(elements.shell4.value)
            ];
        }
        
        function applyPreset(pathwayStr) {
            const [s1, s2, s3, s4] = pathwayStr.split(',');
            elements.shell1.value = s1;
            elements.shell2.value = s2;
            elements.shell3.value = s3;
            elements.shell4.value = s4;
            updatePathwayDisplay();
        }
        
        // ============================================
        // ENCRYPTION
        // ============================================
        async function encryptFile() {
            if (!currentFile) return;
            
            // Check rate limit
            if (userTier === 'free' && usageCount >= usageLimit) {
                checkRateLimit();
                return;
            }
            
            showLoading(true);
            
            try {
                // Read file as base64
                const fileData = await readFileAsBase64(currentFile);
                const pathway = getPathway();
                
                // Prepare headers
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (currentApiKey) {
                    headers['X-API-Key'] = currentApiKey;
                }
                
                // Call API
                const response = await fetch(`${API_BASE}/encrypt`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        plaintext: fileData,
                        pathway: pathway
                    })
                });
                
                if (response.status === 429) {
                    throw new Error('Rate limit exceeded. Please upgrade to Starter for more encryptions.');
                }
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Encryption failed');
                }
                
                const result = await response.json();
                
                // Store results
                encryptedData = {
                    ciphertext: result.ciphertext,
                    filename: currentFile.name
                };
                
                keyData = {
                    key: result.key,
                    pathway: result.pathway_used,
                    filename: currentFile.name,
                    encrypted_at: new Date().toISOString()
                };
                
                // Update usage
                incrementUsage();
                
                // Show results
                elements.resultOriginalSize.textContent = formatFileSize(currentFile.size);
                elements.resultEncryptedSize.textContent = formatFileSize(result.ciphertext.length);
                elements.resultPathway.textContent = '[' + result.pathway_used.join(', ') + ']';
                elements.resultTime.textContent = result.encryption_time_ms.toFixed(2) + ' ms';
                elements.resultsSection.classList.add('visible');
                
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function decryptFile() {
            // For decryption, user needs to also provide the .key file
            // This is a simplified demo - in production you'd have file pairing
            alert('To decrypt, you need both the .encrypted file and the .key file.\n\nPlease use the API directly or contact support for assistance.');
        }
        
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    // Get base64 part after data URL prefix
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // ============================================
        // DOWNLOADS
        // ============================================
        function downloadEncryptedFile() {
            if (!encryptedData) return;
            
            const blob = new Blob([encryptedData.ciphertext], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = encryptedData.filename + '.encrypted';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function downloadKeyFile() {
            if (!keyData) return;
            
            const blob = new Blob([JSON.stringify(keyData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = keyData.filename + '.key';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ============================================
        // UI HELPERS
        // ============================================
        function showLoading(show) {
            elements.loadingOverlay.classList.toggle('visible', show);
        }
        
        // ============================================
        // START
        // ============================================
        init();
    </script>
</body>
</html>
